<h1>Nuevo Pase</h1>
<%= form_for @pase_form.pase do |f| %>

  <p>
  <%= f.label :origen_id %>
  <%= f.select :origen_id, [[@pase_form.reserva, @pase_form.reserva.id]] %>
  </p>

  <p>
  <%= f.label :fecha %>
  <%= f.date_select :fecha, default: Date.today, end_year: Date.today.year %>
  </p>

  <p>
  <%= f.label :monto %>
  <%= f.number_field :monto, step: '0.01', min: 0, required: true %>
    <span id="origen_currency">USD<span>
  </p>

  <fieldset>
    <legend>Cuentas afectadas</legend>
    <label>
      <%= f.radio_button("cuentas_afectadas", "agencia") %>
      Agencia
    </label>
    <label>
      <%= f.radio_button("cuentas_afectadas", "operadora") %>
      Operadora
    </label>
    <label>
      <%= f.radio_button("cuentas_afectadas", "ambas", checked: true) %>
      Ambas
    </label>
  </fieldset>

  <div class="destinos">
  </div>

  <label>Agregar reserva destino
    <select id="nuevo_destino">
      <option value="" selected disabled>Nueva reserva destino</option>
      <%= options_for_select @pase_form.posibles_reservas %>
    </select>
  </label>

  <p>
  <%= f.submit %>
  </p>
<% end %>

<script>
$(document).on('change', '#pase_origen_id', function (e) {
  const selected = $(this.selectedOptions[0])
  $('span.origen_currency').text(selected.data('currency'))
  $('#pase_monto').val(selected.data('saldo'))
})

$(document).on('change', '#nuevo_destino', function (e) {
  const selected = $(this.selectedOptions[0])
  const destino_html ='<fieldset><legend>Pase a ' +
        selected.text() +
        '</legend>' +
        '<label>Monto <input name="pase[destinos][' +
        selected.val() +
        ']"></label> <span>' +
        selected.data('currency') +
        '<span></fieldset>'
  $('.destinos').append(destino_html)
})
</script>

<style>
h1 {
  margin: 20px;
}

form p label {
  display: inline-block;
  width: 90px;
  text-align: right;
}

fieldset {
  width: 400px;
  margin: 20px;
}

label input {
  margin: 3px;
}

form p {
  margin-bottom: 5px;
}

.destinos {
  padding-left: 115px;
}
</style>
